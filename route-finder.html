<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Find the best multimodal travel options in Mumbai, combining direct auto, shared auto, and Western Line trains."
    />
    <title>Multimodal Route Finder - Mumbai Share Auto Finder</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <!-- Leaflet Routing Machine CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"
    />
    <!-- Nominatim Geocoding Control CSS (for Autocomplete UI) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
    />
    <style>
      /* Custom styles for route finder page */
      .route-finder-layout {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      #mapContainer {
        height: 450px;
        width: 100%;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        z-index: 1; /* Ensure map is above other elements if needed */
      }
      .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .input-group .form-group {
        flex: 1;
        margin-bottom: 0;
        position: relative;
      }
      .location-input-btn {
        position: absolute;
        right: 1px;
        top: 1px;
        height: calc(100% - 2px);
        background: var(--color-teal);
        color: white;
        border: none;
        border-radius: 0 8px 8px 0;
        padding: 0 10px;
        cursor: pointer;
        transition: background 0.2s;
        font-weight: 500;
        line-height: 1.2;
      }
      .location-input-btn:hover {
        background: #00695c;
      }
      .leaflet-control-container .leaflet-routing-container {
        display: none !important; /* Hide OSRM output panel initially */
      }
      #resultsContainer {
        padding: 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
      .route-option-card {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        transition: transform 0.2s;
        cursor: pointer;
      }
      .route-option-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .route-option-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px dashed #ddd;
      }
      .route-option-title {
        font-size: 1.1rem;
        font-weight: 600;
      }
      .route-option-details {
        font-size: 0.9rem;
        color: #666;
      }
      .route-summary-cost {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--color-primary);
      }
      .route-summary-time {
        font-size: 1rem;
        font-weight: 500;
        color: var(--color-teal);
      }
      .route-steps-list {
        list-style: none;
        padding: 0;
        margin-top: 10px;
        font-size: 0.9rem;
        border-top: 1px solid #eee;
        padding-top: 10px;
      }
      .route-step {
        padding: 5px 0;
        border-left: 3px solid #f0f0f0;
        padding-left: 10px;
        margin-bottom: 5px;
      }
      .route-step-icon {
        margin-right: 5px;
        font-weight: 600;
      }
      /* Loading State */
      #routeLoading {
        text-align: center;
        padding: 30px;
        color: #1976d2;
      }
      /* Route Card Specific Colors */
      .direct-auto {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
      }
      .shared-auto {
        background: #fffde7;
        border: 1px solid #fff59d;
      }
      .train-combo {
        background: #e8f5e9;
        border: 1px solid #a5d6a7;
      }

      /* FIX: Added style for highlighting active route */
      .active-route {
        border: 2px solid var(--color-primary);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }

      @media (min-width: 1024px) {
        .route-finder-layout {
          grid-template-columns: 2fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-container">
        <!-- FIX: Kept the brand name consistent with other pages -->
        <div class="nav-brand">üõ∫ Mumbai Share Auto</div>

        <ul class="nav-links" id="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="fare-calculator.html">Fare Calculator</a></li>
          <li><a href="stands-map.html">Find Stands</a></li>
          <li><a href="route-finder.html" class="active">Route Finder</a></li>
          <!-- CHANGED LINK: Points to Project 2's external host/port -->
          <li><a href="http://localhost:5500">Booking</a></li>
          <li><a href="safety.html">Safety</a></li>
        </ul>

        <button class="hamburger" aria-label="Open navigation menu">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
    </nav>

    <div class="mobile-menu-backdrop"></div>
    <div class="mobile-menu" aria-hidden="true">
      <button class="mobile-menu-close" aria-label="Close navigation menu">
        &times;
      </button>
      <ul class="mobile-nav-links" id="mobile-nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="fare-calculator.html">Fare Calculator</a></li>
        <li><a href="stands-map.html">Find Stands</a></li>
        <li><a href="route-finder.html" class="active">Route Finder</a></li>
        <!-- CHANGED LINK: Points to Project 2's external host/port -->
        <li><a href="http://localhost:5500">Booking</a></li>
        <li><a href="safety.html">Safety</a></li>
      </ul>
    </div>

    <section class="page-header">
      <h1>Multimodal Route Finder</h1>
      <p class="subtitle">
        Find the quickest and cheapest way to travel across Mumbai.
      </p>
    </section>

    <main class="route-finder-layout">
      <!-- Left Column: Map and Inputs -->
      <section class="calculator-section" style="padding: 0; background: none">
        <div
          class="calculator-card"
          style="max-width: none; margin: 0; padding: 20px"
        >
          <form id="routeFinderForm">
            <div class="input-group">
              <!-- Start Location -->
              <div class="form-group">
                <label for="startLocationInput">Start Location</label>
                <input
                  type="text"
                  id="startLocationInput"
                  class="form-input"
                  placeholder="Type start location or use map"
                  required
                />
                <button
                  type="button"
                  id="pickStartOnMapBtn"
                  class="location-input-btn"
                  title="Pick on map"
                >
                  üìç
                </button>
                <div id="startLocationError" class="error-message"></div>
                <!-- Hidden inputs for coordinates -->
                <input type="hidden" id="startLat" />
                <input type="hidden" id="startLng" />
              </div>

              <!-- End Location -->
              <div class="form-group">
                <label for="endLocationInput">End Location</label>
                <input
                  type="text"
                  id="endLocationInput"
                  class="form-input"
                  placeholder="Type end location or use map"
                  required
                />
                <button
                  type="button"
                  id="pickEndOnMapBtn"
                  class="location-input-btn"
                  title="Pick on map"
                >
                  üéØ
                </button>
                <div id="endLocationError" class="error-message"></div>
                <!-- Hidden inputs for coordinates -->
                <input type="hidden" id="endLat" />
                <input type="hidden" id="endLng" />
              </div>
            </div>

            <div class="button-group">
              <button
                type="button"
                id="findRouteBtn"
                class="btn btn-primary full-width"
              >
                Find Routes
              </button>
              <button
                type="button"
                id="resetBtn"
                class="btn btn-secondary"
                style="width: 120px"
              >
                Reset
              </button>
            </div>
          </form>

          <div id="mapContainer" style="margin-top: 20px"></div>
        </div>
      </section>

      <!-- Right Column: Results Panel -->
      <section id="resultsPanel">
        <div id="resultsContainer" style="padding: 0">
          <h2
            id="resultsHeader"
            class="section-heading"
            style="text-align: left; margin: 0 0 10px 0"
          >
            Available Routes
          </h2>

          <div id="routeLoading" style="display: block">
            <div
              class="spinner-overlay"
              style="position: relative; height: 100px; padding: 0"
            >
              <div class="spinner"></div>
              <!-- FIX: Initial loading text updated to match JS changes -->
              <p>Enter locations to find travel options</p>
            </div>
          </div>

          <div id="routeCardsContainer">
            <!-- Route options will be dynamically inserted here -->
          </div>

          <div
            id="noResultsMessage"
            class="no-results-message"
            style="display: none"
          >
            Could not find any suitable routes. Try adjusting your start/end
            locations.
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-left">
          <p class="footer-copyright">
            &copy; 2024 Mumbai Share Auto Finder. All rights reserved.
          </p>
          <p class="footer-disclaimer">
            Fares and routes are indicative. Please verify with drivers.
          </p>
        </div>
        <div class="footer-right">
          <h3 class="footer-heading">Quick Links</h3>
          <nav class="footer-links">
            <a href="index.html">Home</a>
            <a href="fare-calculator.html">Fare Calculator</a>
            <a href="stands-map.html">Find Stands</a>
            <a href="route-finder.html">Route Finder</a>
            <!-- CHANGED LINK: Points to Project 2's external host/port -->
            <a href="http://localhost:5500">Booking</a>
            <a href="safety.html">Safety</a>
          </nav>
        </div>
      </div>
    </footer>

    <noscript>For the best experience, please enable JavaScript</noscript>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <!-- Leaflet Routing Machine JS (for OSRM) -->
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <!-- Nominatim Geocoding JS -->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script src="js/auth.js"></script>
    <script src="script.js"></script>
    <script src="js/locationService.js"></script>
    <!-- New route-finder.js (needs to be created/updated) -->
    <script src="route-finder.js"></script>
  </body>
</html>
